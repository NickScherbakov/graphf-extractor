# Graph Pipeline

Комплекс для автоматизации: поиск графа в PDF → распознавание структуры → визуализация → анимация.

## О проекте

Graph Pipeline - это набор инструментов для автоматического извлечения графов из PDF-документов с последующим анализом их структуры и созданием визуальных анимаций. Используя возможности компьютерного зрения на базе передовых нейросетевых моделей, проект позволяет:

- Извлекать изображения графов из PDF-документов
- Распознавать структуру графа (вершины и рёбра)
- Генерировать матрицу смежности
- Создавать анимационные ролики визуализации графа и его представления в виде матрицы

## Предварительные требования

- Python 3.10 или выше
- Доступ к OpenAI API или совместимому сервису (например, gptunnel.ru)
- API-ключ для доступа к сервису

## Установка

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/NickScherbakov/graphf-extractor.git
   cd graphf-extractor
   ```

2. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

3. Создайте файл .env в корневой директории проекта и добавьте API ключ:
   ```
   OPENAI_API_KEY=ваш_ключ_api
   ```

4. Для визуализации через manim установите дополнительные компоненты:
   - FFmpeg
   - LaTeX
   
   (см. [официальную документацию Manim](https://docs.manim.community/en/stable/installation.html))

## Быстрый старт

1. Запустите полный пайплайн (извлечение + распознавание + генерация скрипта):
   ```bash
   python -m graph_pipeline.main run --pdf ваш_файл.pdf
   ```
   
   Дополнительные опции:
   ```bash
   python -m graph_pipeline.main run --pdf ваш_файл.pdf --page 2 --model gpt-4o
   ```

2. Запустите анимацию через Manim:
   ```bash
   bash run_manim.sh путь_к_сгенерированному_скрипту.py
   ```

## Доступные команды

### Основной пайплайн

```bash
python -m graph_pipeline.main run --pdf ваш_файл.pdf [опции]
```

Опции:
- `--page N` - номер страницы в PDF для обработки (по умолчанию 1)
- `--output-dir DIR` - директория для сохранения извлеченных изображений
- `--manim-script-dir DIR` - директория для сохранения сгенерированного Manim-скрипта
- `--model ID` - явно указать ID модели для распознавания (например, gpt-4o)
- `--api-base-url URL` - базовый URL для API (по умолчанию: https://gptunnel.ru/v1)
- `--force-model-update` - принудительное обновление кэша моделей
- `--skip-vision-check` - пропустить API-проверку возможностей vision
- `--skip-manim` - пропустить генерацию Manim-скрипта

### Обновление кэша моделей

```bash
python -m graph_pipeline.main update-models [опции]
```

Опции:
- `--api-base-url URL` - базовый URL для API
- `--force` - принудительное обновление даже при актуальном кэше
- `--skip-vision-check` - пропустить проверку vision-возможностей моделей

### Анализ логов

```bash
python log_analyzer.py [опции]
```

Опции:
- `--api` - показать статистику API-вызовов
- `--tests` - показать статистику тестов
- `--changes` - показать изменения в коде
- `--activities` - показать последние активности
- `--all` - показать всю статистику
- `--debug` - показать отладочную информацию

## Структура проекта

### Основные компоненты

- `graph_pipeline/` - основной модуль:
  - `extract_graph_image.py` - извлекает изображения из PDF
  - `graph_structure_extractor.py` - распознаёт вершины и рёбра графа
  - `generate_manim_advanced.py` - создаёт manim-скрипт с поэтапной анимацией
  - `main.py` - мастер-скрипт для CLI интерфейса
  - `model_manager.py` - управление моделями API
  - `logger.py` - система логирования операций
  - `tests/` - модульные тесты

### Утилиты

- `run_manim.sh` - запуск анимации через manim
- `log_analyzer.py` - анализ логов и статистики системы
- `logs_check.py` - просмотр и анализ логов

## Система логирования

Проект включает детальную систему логирования, которая отслеживает:
- API-вызовы и их стоимость
- Запуски тестов и их результаты
- Изменения в коде

Логи сохраняются в директории `logs/`:
- `api_usage_stats.json` - статистика использования API
- `test_runs.jsonl` - записи о запусках тестов
- `*.log` - текстовые логи работы системы

## Тестирование

Для запуска всех тестов используйте:
```bash
pytest
```

Для запуска тестов API (требует API-ключа):
```bash
pytest --expensive
```

Для быстрого тестирования распознавания изображения:
```bash
python run_test_image.py путь_к_изображению
```

## Проверка качества кода

- Проверка стиля и ошибок:
  ```bash
  flake8
  ```
- Форматирование кода:
  ```bash
  black .
  ```
- Проверка аннотаций типов:
  ```bash
  mypy .
  ```

## Схема работы проекта

Подробная схема компонентов и потока данных доступна в файле `PROJECT_STRUCTURE.md`.

## Лицензия

Проект распространяется под лицензией MIT. См. файл [LICENSE](LICENSE) для деталей.

## Автор

© 2025 [NickScherbakov](https://github.com/NickScherbakov)
